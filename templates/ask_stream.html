<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Farm Assistant â€” Streaming</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="/static/css/custom.css" />
</head>
<body>
    <div class="layout chat-layout hidden" id="app-layout">
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Chats</h2>
                <button id="new-chat">ï¼‹ New</button>
            </div>
            <ul id="session-list" class="session-list">
                <!-- Filled by JS -->
            </ul>
        </aside>

        <div class="wrap">
            <div class="auth-info" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span class="muted">
                    Welcome, <span id="chat-user-name"></span>
                    <span style="opacity:.8;">(<span id="chat-user-email"></span>)</span>
                </span>
                <button id="logout-btn" type="button">Logout</button>
            </div>

            <h1>Farm Assistant (Streaming)</h1>

            <div class="chat-shell">
                <div id="chat" class="chat" aria-live="polite" aria-busy="false"></div>

                <form id="qform" class="bar composer">
                    <input id="question" type="text" placeholder="Ask a questionâ€¦" autocomplete="off" />

                    <label class="actions" style="font-size: 13px;">
                        <input id="speak-toggle" type="checkbox" />
                        <span class="muted">Speak</span>
                    </label>

                    <select id="voice-select" aria-label="Voice profile">
                        <option value="en-gb-neutral" selected>English (UK) â€” Neutral</option>
                        <option value="en-gb-male">English (UK) â€” Male</option>
                        <option value="en-gb-female">English (UK) â€” Female</option>
                    </select>

                    <button id="play-last" type="button">ðŸ”Š Listen</button>

                    <select id="model" aria-label="Model" class="hidden">
                        <option value="deepseek-llm:7b-chat-q5_K_M" selected>DeepSeek 7B Chat Q5_K_M</option>
                    </select>
                    <button id="send" type="submit">Send</button>
                    <button id="stop" type="button" class="hidden">Stop</button>
                </form>

                <div class="audio-row">
                    <audio id="live-audio" preload="none" controls></audio>
                </div>
            </div>
        </div>
    </div>

    <script>
        // If no token, send user back to login page
        (function () {
            const token = localStorage.getItem('fa_access_token');
            if (!token) {
                window.location.href = "/";
            }
        })();
    </script>

    <script src="/static/js/tts.js"></script>
    <script src="/static/js/chat.js"></script>
</body>
</html>
